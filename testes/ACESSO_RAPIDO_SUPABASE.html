<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acesso R√°pido - Supabase</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container {
            background: white;
            color: #333;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .project-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .project-info h3 {
            color: #495057;
            margin-bottom: 15px;
        }
        .info-item {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        .info-item strong {
            color: #007bff;
        }
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            margin: 10px 5px;
            transition: background 0.3s;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn-success {
            background: #28a745;
        }
        .btn-success:hover {
            background: #1e7e34;
        }
        .btn-warning {
            background: #ffc107;
            color: #000;
        }
        .btn-warning:hover {
            background: #e0a800;
        }
        .btn-danger {
            background: #dc3545;
        }
        .btn-danger:hover {
            background: #c82333;
        }
        .section {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        .section h3 {
            color: #495057;
            margin-bottom: 15px;
        }
        .step {
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }
        .step-number {
            background: #28a745;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
        }
        .url-box {
            background: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
            word-break: break-all;
        }
        .copy-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        .copy-btn:hover {
            background: #5a6268;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Acesso R√°pido - Supabase</h1>
            <p>Configure seu projeto Supabase em poucos cliques</p>
        </div>

        <div class="project-info">
            <h3>üìã Informa√ß√µes do Projeto</h3>
            <div class="info-item">
                <strong>Project ID:</strong> kaqkzrngebxfuvquromi
                <button class="copy-btn" onclick="copyToClipboard('kaqkzrngebxfuvquromi')">Copiar</button>
            </div>
            <div class="info-item">
                <strong>URL do Projeto:</strong> https://kaqkzrngebxfuvquromi.supabase.co
                <button class="copy-btn" onclick="copyToClipboard('https://kaqkzrngebxfuvquromi.supabase.co')">Copiar</button>
            </div>
            <div class="info-item">
                <strong>Dashboard:</strong> https://supabase.com/dashboard/project/kaqkzrngebxfuvquromi
                <button class="copy-btn" onclick="copyToClipboard('https://supabase.com/dashboard/project/kaqkzrngebxfuvquromi')">Copiar</button>
            </div>
        </div>

        <div class="section">
            <h3>üîó Links Diretos</h3>
            <a href="https://supabase.com/dashboard/project/kaqkzrngebxfuvquromi" target="_blank" class="btn btn-success">
                üìä Abrir Dashboard Supabase
            </a>
            <a href="https://supabase.com/dashboard/project/kaqkzrngebxfuvquromi/auth/settings" target="_blank" class="btn">
                üîê Configurar Authentication
            </a>
            <a href="https://supabase.com/dashboard/project/kaqkzrngebxfuvquromi/sql" target="_blank" class="btn">
                üìù SQL Editor
            </a>
            <a href="https://supabase.com/dashboard/project/kaqkzrngebxfuvquromi/table-editor" target="_blank" class="btn">
                üóÑÔ∏è Table Editor
            </a>
        </div>

        <div class="section">
            <h3>‚öôÔ∏è Configura√ß√£o R√°pida</h3>
            
            <div class="step">
                <span class="step-number">1</span>
                <strong>Configurar Authentication</strong>
                <p>Clique no bot√£o "Configurar Authentication" acima e configure:</p>
                <div class="url-box">
                    Site URL: https://scm-supabase.vercel.app
                </div>
                <div class="url-box">
                    Redirect URLs:<br>
                    https://scm-supabase.vercel.app<br>
                    https://scm-supabase.vercel.app/login.html<br>
                    https://scm-supabase.vercel.app/SCM_Supabase.html<br>
                    https://scm-supabase.vercel.app/admin-interno.html<br>
                    https://scm-supabase.vercel.app/**
                </div>
                <p><strong>Desabilitar:</strong> Email confirmations e Email change confirmations</p>
            </div>

            <div class="step">
                <span class="step-number">2</span>
                <strong>Executar Schema SQL</strong>
                <p>Clique no bot√£o "SQL Editor" acima e execute o arquivo:</p>
                <div class="url-box">supabase_schema_minimo.sql</div>
                <p><strong>IMPORTANTE:</strong> Use o schema m√≠nimo - apenas o essencial!</p>
                <p>Deve mostrar "‚úÖ Schema m√≠nimo criado com sucesso!"</p>
                <button class="copy-btn" onclick="copySchema('minimo')">üìã Copiar Schema M√≠nimo</button>
            </div>

            <div class="step">
                <span class="step-number">3</span>
                <strong>Verificar Tabelas</strong>
                <p>Clique no bot√£o "Table Editor" acima e confirme que existem:</p>
                <div class="url-box">
                    ‚úÖ users<br>
                    ‚úÖ products<br>
                    ‚úÖ movements<br>
                    ‚úÖ custom_types<br>
                    ‚úÖ audit_log
                </div>
            </div>

            <div class="step">
                <span class="step-number">4</span>
                <strong>Testar Sistema</strong>
                <p>Execute os testes para verificar se tudo est√° funcionando:</p>
                <a href="https://scm-supabase.vercel.app/TESTE_DIAGNOSTICO_COMPLETO.html" target="_blank" class="btn btn-warning">
                    üß™ Diagn√≥stico Completo
                </a>
                <a href="https://scm-supabase.vercel.app/CRIAR_ADMIN.html" target="_blank" class="btn btn-success">
                    üëë Criar Admin
                </a>
            </div>
        </div>

        <div class="section">
            <h3>üß™ Testes do Sistema</h3>
            <a href="https://scm-supabase.vercel.app/TESTE_DIAGNOSTICO_COMPLETO.html" target="_blank" class="btn">
                üîç Diagn√≥stico Completo
            </a>
            <a href="https://scm-supabase.vercel.app/TESTE_CONEXAO.html" target="_blank" class="btn">
                üîó Teste de Conex√£o
            </a>
            <a href="https://scm-supabase.vercel.app/TESTE_CONFIG_SUPABASE.html" target="_blank" class="btn">
                ‚öôÔ∏è Teste de Configura√ß√£o
            </a>
            <a href="https://scm-supabase.vercel.app/login.html" target="_blank" class="btn btn-success">
                üîê Teste de Login
            </a>
        </div>

        <div class="section">
            <h3>üìö Documenta√ß√£o</h3>
            <p>Para instru√ß√µes detalhadas, consulte:</p>
            <ul>
                <li><strong>CONFIGURAR_SUPABASE_COMPLETO.md</strong> - Guia completo de configura√ß√£o</li>
                <li><strong>CORRIGIR_ERRO_USER_NOT_ALLOWED.md</strong> - Solu√ß√£o para erro de usu√°rio</li>
                <li><strong>ADMIN_INTERNO.md</strong> - Como usar o admin interno</li>
            </ul>
        </div>
    </div>

    <script>
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(function() {
                alert('Copiado para a √°rea de transfer√™ncia!');
            }, function(err) {
                console.error('Erro ao copiar: ', err);
                // Fallback para navegadores mais antigos
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Copiado para a √°rea de transfer√™ncia!');
            });
        }

        function copySchema(type) {
            const schemas = {
                'minimo': `-- ===== SCHEMA M√çNIMO - APENAS O ESSENCIAL =====
-- Este √© o schema mais simples poss√≠vel, apenas para o sistema funcionar

-- 1. Criar tabela de usu√°rios
CREATE TABLE IF NOT EXISTS public.users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) UNIQUE NOT NULL,
    full_name VARCHAR(255) NOT NULL,
    role VARCHAR(50) DEFAULT 'user',
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 2. Criar tabela de produtos
CREATE TABLE IF NOT EXISTS public.products (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(255) NOT NULL,
    description TEXT,
    quantity INTEGER DEFAULT 0,
    min_quantity INTEGER DEFAULT 0,
    unit VARCHAR(50) DEFAULT 'unidade',
    type VARCHAR(100) DEFAULT 'material',
    location VARCHAR(255),
    supplier VARCHAR(255),
    cost DECIMAL(10,2),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 3. Criar tabela de movimenta√ß√µes
CREATE TABLE IF NOT EXISTS public.movements (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    product_id UUID REFERENCES public.products(id) ON DELETE CASCADE,
    type VARCHAR(50) NOT NULL,
    quantity INTEGER NOT NULL,
    reason VARCHAR(255),
    notes TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 4. Criar tabela de tipos customizados
CREATE TABLE IF NOT EXISTS public.custom_types (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(100) NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 5. Criar tabela de auditoria
CREATE TABLE IF NOT EXISTS public.audit_log (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_email VARCHAR(255),
    action VARCHAR(100),
    table_name VARCHAR(100),
    record_id UUID,
    details TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 6. Habilitar RLS (Row Level Security)
ALTER TABLE public.users ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.products ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.movements ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.custom_types ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.audit_log ENABLE ROW LEVEL SECURITY;

-- 7. Criar pol√≠ticas permissivas (acesso total para desenvolvimento)
DROP POLICY IF EXISTS "Allow all on users" ON public.users;
CREATE POLICY "Allow all on users" ON public.users FOR ALL USING (true);

DROP POLICY IF EXISTS "Allow all on products" ON public.products;
CREATE POLICY "Allow all on products" ON public.products FOR ALL USING (true);

DROP POLICY IF EXISTS "Allow all on movements" ON public.movements;
CREATE POLICY "Allow all on movements" ON public.movements FOR ALL USING (true);

DROP POLICY IF EXISTS "Allow all on custom_types" ON public.custom_types;
CREATE POLICY "Allow all on custom_types" ON public.custom_types FOR ALL USING (true);

DROP POLICY IF EXISTS "Allow all on audit_log" ON public.audit_log;
CREATE POLICY "Allow all on audit_log" ON public.audit_log FOR ALL USING (true);

-- 8. Inserir usu√°rio admin padr√£o
INSERT INTO public.users (id, email, full_name, role, is_active)
VALUES (
    '00000000-0000-0000-0000-000000000001',
    'admin@scm.local',
    'Administrador',
    'admin',
    true
) ON CONFLICT (id) DO NOTHING;

-- 9. Inserir tipos customizados (sem description)
INSERT INTO public.custom_types (name)
VALUES 
    ('Material de Constru√ß√£o'),
    ('Ferramentas'),
    ('Equipamentos de Seguran√ßa'),
    ('Limpeza')
ON CONFLICT DO NOTHING;

-- Mensagem de sucesso
DO $$
BEGIN
    RAISE NOTICE '‚úÖ Schema m√≠nimo criado com sucesso!';
    RAISE NOTICE '‚úÖ Tabelas: users, products, movements, custom_types, audit_log';
    RAISE NOTICE '‚úÖ Usu√°rio admin: admin@scm.local';
    RAISE NOTICE '‚úÖ Tipos customizados criados';
    RAISE NOTICE '‚öôÔ∏è Configure Authentication URLs no Supabase';
    RAISE NOTICE 'üöÄ Sistema pronto para uso!';
END $$;`,
                'final': `-- ===== SCHEMA SQL FINAL - SEM FUN√á√ïES PROBLEM√ÅTICAS =====
-- Este script √© a vers√£o mais simples e funcional

-- 1. Criar tabela de usu√°rios (sem refer√™ncia ao auth.users)
CREATE TABLE IF NOT EXISTS public.users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) UNIQUE NOT NULL,
    full_name VARCHAR(255) NOT NULL,
    role VARCHAR(50) DEFAULT 'user' CHECK (role IN ('user', 'admin')),
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 2. Criar tabela de produtos
CREATE TABLE IF NOT EXISTS public.products (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(255) NOT NULL,
    description TEXT,
    quantity INTEGER DEFAULT 0,
    min_quantity INTEGER DEFAULT 0,
    unit VARCHAR(50) DEFAULT 'unidade',
    type VARCHAR(100) DEFAULT 'material',
    location VARCHAR(255),
    supplier VARCHAR(255),
    cost DECIMAL(10,2),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 3. Criar tabela de movimenta√ß√µes
CREATE TABLE IF NOT EXISTS public.movements (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    product_id UUID NOT NULL REFERENCES public.products(id) ON DELETE CASCADE,
    type VARCHAR(50) NOT NULL CHECK (type IN ('entrada', 'saida', 'ajuste')),
    quantity INTEGER NOT NULL,
    reason VARCHAR(255),
    notes TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 4. Criar tabela de tipos customizados
CREATE TABLE IF NOT EXISTS public.custom_types (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(100) NOT NULL,
    description TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 5. Criar tabela de auditoria (simplificada)
CREATE TABLE IF NOT EXISTS public.audit_log (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_email VARCHAR(255),
    action VARCHAR(100) NOT NULL,
    table_name VARCHAR(100) NOT NULL,
    record_id UUID,
    details TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 6. Criar √≠ndices para performance
CREATE INDEX IF NOT EXISTS idx_products_name ON public.products(name);
CREATE INDEX IF NOT EXISTS idx_products_type ON public.products(type);
CREATE INDEX IF NOT EXISTS idx_movements_product_id ON public.movements(product_id);
CREATE INDEX IF NOT EXISTS idx_movements_created_at ON public.movements(created_at);
CREATE INDEX IF NOT EXISTS idx_audit_log_created_at ON public.audit_log(created_at);

-- 7. Habilitar RLS (Row Level Security)
ALTER TABLE public.users ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.products ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.movements ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.custom_types ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.audit_log ENABLE ROW LEVEL SECURITY;

-- 8. Remover pol√≠ticas existentes (se houver) e criar novas
-- Users
DROP POLICY IF EXISTS "Allow all operations on users" ON public.users;
CREATE POLICY "Allow all operations on users" ON public.users
FOR ALL USING (true);

-- Products
DROP POLICY IF EXISTS "Allow all operations on products" ON public.products;
CREATE POLICY "Allow all operations on products" ON public.products
FOR ALL USING (true);

-- Movements
DROP POLICY IF EXISTS "Allow all operations on movements" ON public.movements;
CREATE POLICY "Allow all operations on movements" ON public.movements
FOR ALL USING (true);

-- Custom Types
DROP POLICY IF EXISTS "Allow all operations on custom_types" ON public.custom_types;
CREATE POLICY "Allow all operations on custom_types" ON public.custom_types
FOR ALL USING (true);

-- Audit Log
DROP POLICY IF EXISTS "Allow all operations on audit_log" ON public.audit_log;
CREATE POLICY "Allow all operations on audit_log" ON public.audit_log
FOR ALL USING (true);

-- 9. Fun√ß√£o para atualizar updated_at automaticamente
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ language 'plpgsql';

-- 10. Triggers para updated_at (apenas nas tabelas que t√™m updated_at)
DROP TRIGGER IF EXISTS update_users_updated_at ON public.users;
CREATE TRIGGER update_users_updated_at BEFORE UPDATE ON public.users
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

DROP TRIGGER IF EXISTS update_products_updated_at ON public.products;
CREATE TRIGGER update_products_updated_at BEFORE UPDATE ON public.products
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

-- 11. Inserir usu√°rio admin padr√£o (se n√£o existir)
INSERT INTO public.users (id, email, full_name, role, is_active)
VALUES (
    '00000000-0000-0000-0000-000000000001',
    'admin@scm.local',
    'Administrador do Sistema',
    'admin',
    true
) ON CONFLICT (id) DO NOTHING;

-- 12. Inserir alguns tipos customizados de exemplo
INSERT INTO public.custom_types (name, description)
VALUES 
    ('Material de Constru√ß√£o', 'Materiais para constru√ß√£o civil'),
    ('Ferramentas', 'Ferramentas e equipamentos'),
    ('Equipamentos de Seguran√ßa', 'EPIs e equipamentos de seguran√ßa'),
    ('Limpeza', 'Produtos de limpeza e higiene')
ON CONFLICT DO NOTHING;

-- 13. Mensagem de sucesso
DO $$
BEGIN
    RAISE NOTICE 'Schema criado com sucesso!';
    RAISE NOTICE 'Tabelas criadas: users, products, movements, custom_types, audit_log';
    RAISE NOTICE 'Usu√°rio admin padr√£o: admin@scm.local';
    RAISE NOTICE 'Tipos customizados de exemplo inseridos';
    RAISE NOTICE 'Configure as URLs no Authentication Settings do Supabase';
    RAISE NOTICE 'Agora voc√™ pode criar usu√°rios sem erro!';
END $$;`
            };
            
            if (schemas[type]) {
                copyToClipboard(schemas[type]);
            } else {
                alert('Schema n√£o encontrado!');
            }
        }
    </script>
</body>
</html>
